<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: webdev | Bits, Bytes, and Words]]></title>
  <link href="https://blog.jez.io/categories/webdev/atom.xml" rel="self"/>
  <link href="https://blog.jez.io/"/>
  <updated>2019-05-21T04:46:49-04:00</updated>
  <id>https://blog.jez.io/</id>
  <author>
    <name><![CDATA[Jake Zimmerman]]></name>
    <email><![CDATA[jake@zimmerman.io]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Using Google OAuth2 for CMU Authentication]]></title>
    <link href="https://blog.jez.io/2014/10/20/using-google-apps-for-cmu-authentication/"/>
    <updated>2014-10-20T06:11:37-04:00</updated>
    <id>https://blog.jez.io/2014/10/20/using-google-apps-for-cmu-authentication</id>
    <content type="html"><![CDATA[<p>Using <code>python-social-auth</code> and Django, I&rsquo;ve found a very straightfoward way of adding authentication to apps designed for CMU students. Given that all Andrew accounts are now Google Apps @ CMU accounts, we can take advantage of the widely used Google OAuth2 libraries to authenticate users, but just restrict sign-ins to the <code>andrew.cmu.edu</code> &ldquo;hosted domain.&rdquo;</p>

<!-- more -->


<h2>Background</h2>

<p>Finally! I&rsquo;ve alluded many times to blogging about some of the things I&rsquo;m learning from my experiences rewriting <a href="http://print.scottylabs.org/">Print@ScottyLabs</a>. After a summer of putting it off and half a semester more of dawdling, I&rsquo;ve finally managed to lay some solid groundwork.</p>

<p>One of the features that we plan on adding to Print 2.0 is a web interface. For people familiar with the way Print works currently, you interact with the service entirely through email. This leads to a clunky user experience and a lot of weird bugs and edge cases. With a web interface, we hope to streamline the process of account management and printing documents.</p>

<p>With this in mind, we needed to decide on a user model. Ideally, we&rsquo;d like this model to give us two things:</p>

<ul>
<li><strong>It should be secure.</strong> People who don&rsquo;t already have access to CMU printers shoudn&rsquo;t be able to easy gain access by using our system.</li>
<li><strong>It should be familiar.</strong> We want to design Print 2.0 to be as close to an official-feeling CMU app as we can without stepping on the ever-present administrative toes.</li>
</ul>


<p>Naturally, this leads to an obvious solution: have people sign in using the same <a href="https://login.cmu.edu">https://login.cmu.edu</a> site, which is used for email, Blackboard, AutoLab, and many other on-campus services. The trick, then, is to figure out how to do this.</p>

<p>My first thought was to &ldquo;use Shibboleth.&rdquo; I put this in quotes because I didn&rsquo;t exactly know what that meant at the time. What I was looking for was a simple OAuth2 API (like what Google or Facebook provide) that I could much just drop into my app with no other configuration required on the deployment machine. Shibboleth does not offer this solution.</p>

<p>Luckily, Google&rsquo;s OAuth2 API has a feature that allowed me to do exactly what I wanted. Thanks to a couple of resourceful members of the CMU Computer Science Facebook group (Carlos Diaz-Padron and Arthur Lee), I found out about a barely-documented parameter that you can pass in on the auth URL to restrict Google OAuth2 logins to a <a href="https://developers.google.com/accounts/docs/OAuth2Login#hd-param">specific hosted domain</a>. Since all CMU Andrew accounts are Google Apps accounts (as of Fall 2013), we can ask Google to restrict logins to the <code>'andrew.cmu.edu'</code> hosted domain. From here on, the only trick is to get whatever client library you&rsquo;re using to handle authentication to pass this parameter with a value of <code>'andrew.cmu.edu'</code> along to Google. The rest of this post describes a bare-bones way of doing this using Django.</p>

<h2>Implementing Authentication</h2>

<p>The following is a pretty long-winded explanation of my personal struggles with this. If you&rsquo;d really just like to learn by example and by making your own mistakes, check out the <a href="https://github.com/jez/google-apps-cmu-login/">code on GitHub</a>. I also found the <a href="https://github.com/omab/python-social-auth/tree/master/examples/"><code>python-social-auth</code> examples</a> very helpful. In the spirit of <a href="http://www.gitorial.com/">gitorial</a>, the commits are structured logically to give you a sense of how the app came together as I wrote it. In fact, I&rsquo;ve even <a href="http://www.gitorial.com/#/jez/25536683">made a gitorial</a> for this repo!</p>

<h3>Python Social Auth</h3>

<p>First up: pick a client library. I&rsquo;ve had success using <code>python-social-auth</code> in other projects, and it&rsquo;s generally a mature project, so it&rsquo;s what I picked.</p>

<p>Next up: skim the docs. Given the enormous size of this project (it has solutions for tons of python frameworks and tons of authentication backends), the docs are pretty comprehensive. Unfortunately, they fell short in the one place where I needed to look.</p>

<p>One of the neat things about the python social auth library is that it can be easily extended to support additional authentications backends using simple object-oriented techniques. To make this happen, very few pieces of information are hardcoded; in particular, the names of the variables that allow for configuration are dynamically generated based on the available backends.</p>

<p><a href="https://python-social-auth.readthedocs.org/en/latest/configuration/settings.html#extra-arguments-on0auth-processes">This page</a> outlines how to pass in extra, optional arguments while constructing the redirect URI for a particular authentication backend. It hints at the names of the variables that need to be defined, but sadly these hints are wrong.</p>

<p><strong>This is a correction to the documentation provided at the above link.</strong> Extra authentication arguments can be passed in using any of the following variables:</p>

<ul>
<li><code>SOCIAL_AUTH_&lt;backend&gt;_AUTH_EXTRA_ARGUMENTS</code></li>
<li><code>SOCIAL_AUTH_AUTH_EXTRA_ARGUMENTS</code> (no, this is not a typo)</li>
<li><code>AUTH_EXTRA_ARGUMENTS</code></li>
</ul>


<p>I&rsquo;m not sure what the difference between using the second and third variables are, but all variables of the first form will allow you to scope the extra arguments to a particular backend (in case you&rsquo;re using more than one in the same app).</p>

<p>So in my case, I added the following line to my <code>settings.py</code>:</p>

<pre><code class="python settings.py https://github.com/jez/google-apps-cmu-login/blob/master/config/settings.py#L66">SOCIAL_AUTH_GOOGLE_OAUTH2_AUTH_EXTRA_ARGUMENTS = {'hd' : 'andrew.cmu.edu'}
</code></pre>

<p>Phew. That&rsquo;s a long variable name. But Jake, how did you come up with <code>GOOGLE_OAUTH2</code> for the backend name? There&rsquo;s really no good answer to this, because I haven&rsquo;t been able to find a web-readable list of all the names in one place. The way this name is generated is by taking the <code>name</code> property of the particular backend you&rsquo;re using (in my case, <code>social.backends.google.GoogleOAuth2</code> has <code>name = 'google-oauth2'</code>, which I found by looking at the source), replacing all hyphens with underscores and making everything capital.</p>

<h3>The Django App</h3>

<p>Now you should plenty of background knowledge to make sense of the Django app on your own, but I&rsquo;ll reiterate the main points here for completeness. It will be pretty choppy in most places if you&rsquo;re not referring to my example app on GitHub as you read.</p>

<p>First, we&rsquo;ll get all our URLs in place. For Django, all the URLs dealing with logging in are already defined; we just have to include them:</p>

<pre><code class="python config/urls.py https://github.com/jez/google-apps-cmu-login/blob/master/config/urls.py#L10">    ...
    url(r'', include('social.apps.django_app.urls', namespace='social')),
    ...
</code></pre>

<p>Then we can set up some simple URLs (a home page and a logout view), and accompanying views for these URLs that do exactly what you think they should.</p>

<p>In our template, if the user is logged in, we&rsquo;ll show their AndrewID (<code>user.username</code>), or else we&rsquo;ll hardcode the link to the Google OAuth2 authentication backend.</p>

<p><strong>Note</strong>: if you plan on using multiple forms of authentication (like Facebook or GitHub) in this app, be sure to check out the python social auth example for how they generate their home page such that no URLs need to be hard coded. For our purposes, though, if there&rsquo;s only one URL it will be fine to just write it out.</p>

<h3>Demo</h3>

<iframe width="420" height="315" src="//www.youtube.com/embed/GYRUvTvTSJE" frameborder="0" allowfullscreen></iframe>


<h3>Going Forward</h3>

<p>That&rsquo;s basically it. The rest is up to you to fill in. Building off this model, you should be able to make basically any Django app that you&rsquo;d otherwise want to build.</p>

<p>One thing you&rsquo;ll want to look into is defining a custom Auth User model. Custom Auth User models allow you to plug into Django&rsquo;s default auth system to take advantage of all the features it has available for keeping track of your users. The <a href="https://docs.djangoproject.com/en/dev/topics/auth/customizing/">Django docs</a> on this topic are actually pretty good, though you&rsquo;ll likely want to find an example to help you work through the specifics.</p>

<p>As always, let me know if you have any questions or if by following these steps something didn&rsquo;t work for you. Because of how bare bones this app is, it&rsquo;s likely that I glossed over some points for the sake of minimalism. Comment below with your feedback and feel free to email me or make GitHub issues with your questions.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[HPSTR: An Octopress Theme]]></title>
    <link href="https://blog.jez.io/2014/06/04/hpstr-an-octopress-theme/"/>
    <updated>2014-06-04T21:51:41-04:00</updated>
    <id>https://blog.jez.io/2014/06/04/hpstr-an-octopress-theme</id>
    <content type="html"><![CDATA[<p>In case you didn&rsquo;t notice, we&rsquo;re rocking a new theme: <a href="https://github.com/jez/hpstr-theme">HPSTR for Octopress</a>! Ported from the <a href="https://github.com/mmistakes/hpstr-jekyll-theme">theme of the same name</a> for Jekyll, this theme has a bunch of cool new features that make the theme easier to use and more customizable.</p>

<!-- more -->


<p>Before I begin, I have to give a huge shout out to <a href="https://github.com/mmistakes/">mmistakes</a> for crafting such an impeccable set of stylesheets and Jekyll templates. I could talk this theme up all day, but I think that the results speak for themselves. Even more praiseworthy is that the entire source code is licensed under the GPL, enabling anyone to take the source and build upon it. And on that note, I&rsquo;d like to unveil what <em>I&rsquo;ve</em> built.</p>

<h1>Ported to Octopress</h1>

<p>The theme was originally implemented for a vanilla Jekyll blog. Personally, I find the automation tools provided by Octopress to be incredibly helpful, and I didn&rsquo;t want to give these up to be able to deploy this theme. As a result, I had to tweak a few things in order to get it to work with a standard Octopress installation.</p>

<h2>Less to Sass</h2>

<p>The HPSTR theme was originally built using Less to compile its stylesheets. Octopress uses Sass under Compass instead&ndash;a decision which I love: the rich library of plugins that Compass provides is ridiculous. Thus, this was the first step of the port.</p>

<p>After a quick Google search I stumbled upon <a href="https://stackoverflow.com/questions/14970224/anyone-know-of-a-good-way-to-convert-from-less-to-sass">this question</a> on Stack Overflow, which surprisingly took care of the vast majority of the conversion, leveraging mere text replacement. From there, it was mostly a matter of slugging through the Less docs to find out what a particular function did, jumping over to the Compass/Sass docs to find a corresponding mixin, and repeating.</p>

<h2>Sass to Compass</h2>

<p>I didn&rsquo;t stop after I had the vanilla Sass working. One of Compass&rsquo;s coolest features is that you don&rsquo;t have to repeat yourself: there are mixins for seemingly everything, and when there aren&rsquo;t, there are 3<sup>rd</sup> party plugins. Thus, the next phase of the port was to see how much of the code I could reduce to compass mixins.</p>

<p>For the most part, this stage affected CSS3 properties which need vendor prefixes, to include keyframe animations. The keyframe animations are particularly worthy of a mention because I found a handy plugin called <a href="https://github.com/ericam/compass-animation">compass-animation</a> to take care of them. It works as easily as any other Compass mixin, from installation to use.</p>

<h2>Octopress Mannerisms</h2>

<p>There are a few things that Octopress users can expect to be reasonably similar from one deployment to the next, and I wanted to ensure that as many of the features dually implemented by mmistakes and Octopress used the syntax or conformed to the style set forth by Octopress. A small example of this: the <code>page.link</code> and <code>page.external_url</code> properties. Defined by the old and new themes respectively, both accomplish a similar purpose. Each specifies that the main purpose of the post is to link to a different page. Not wanting to break the service for current Octopress users, I tried to convert as many of these subtleties.</p>

<p>On top of this, I restructured a lot of the original code so that someone used to customizing an Octopress theme would feel more at home when checking out the source for this theme, even if some of the particulars were different. This applied mostly to the Sass directory structure, but also to the templates.</p>

<h1>More Powerful Customization</h1>

<p>One of the many ways Octopress adds value on top of Jekyll is the ease with which you can get a Jekyll blog up and running, and subsequently customize and tweak that theme. This was one area where I felt that the original Jekyll theme fell short. The original stylesheets had a somewhat decent set of variables (in <code>less/variables.less</code>) that would allow you to customize the colors and font faces, but the method for customizing the size of the font was wonky (larger values produced smaller fonts), and the various mixins employed to handle setting the sizes were confusing.</p>

<p>To solve this, I added <em>loads</em> of new variables handling the font sizes and line heights on a per-component basis, while also providing a master switch to easily resize everything. My theme also differs here from the original in that it&rsquo;s default font size is slightly larger for normal paragraph text (the whole reason why I cared about customizing the font size in the first place!).</p>

<h1>Like what you see?</h1>

<p>This theme is in no way perfect, from the styles to the compatibility with the vast array of Octopress options. If my support for your favorite feature is lacking or absent altogether, patch it up and submit a pull request on <a href="https://github.com/jez/hpstr-theme">GitHub</a>!</p>

<p><strong>I&rsquo;d also love to hear about your installation process.</strong> If something didn&rsquo;t quite work out right when installing the theme from GitHub or everything went super smoothly, tell me on GitHub in an issue, on <a href="https://www.twitter.com/Z1MM32M4N">Twitter</a>, in the comments below, or in an <a href="mailto:jake@zimmerman.io">email</a>. Seriously!</p>
]]></content>
  </entry>
  
</feed>
