
<!DOCTYPE html>

<head>


<meta charset="utf-8">
<meta http-equiv="cleartype" content="on">

<title>SML Dev Setup - Bits, Bytes, and Words</title>
<meta name="author" content="Jake Zimmerman">




<meta name="description" content="Let's walk through a couple easy steps you can take to make developing SML feel more fluid, both in and out of your editor.
">

<meta name="keywords" content="vim osx sml ">


<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Twitter Cards -->

  <meta name="twitter:card" content="summary">
  <meta name="twitter:image" content="https://blog.jez.io/touch-icon.png">
  <meta name="twitter:title" content="SML Dev Setup">
  <meta name="twitter:description" content="Let's walk through a couple easy steps you can take to make developing SML feel more fluid, both in and out of your editor.
">
  <meta name="twitter:creator" content="@jez_io">


<!-- Open Graph -->
<meta property="og:local" content="en_US">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.jez.io/sml-dev-setup">
<meta property="og:title" content="SML Dev Setup">
<meta property="og:description" content="Let's walk through a couple easy steps you can take to make developing SML feel more fluid, both in and out of your editor.
">
<meta property="og:image" content="https://blog.jez.io/touch-icon.png">
<meta property="og:site_name" content="Bits, Bytes, and Words">

<link rel="canonical" href="https://blog.jez.io/sml-dev-setup">
<link href="/touch-icon.png" rel="apple-touch-icon-precomposed">
<link href="/favicon@2x.png" rel="icon" sizes="32x32">
<link href="/favicon.png" rel="icon" sizes="16x16">
<link href="/fonts/concourse.css" rel="stylesheet">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
<link href="/atom.xml" rel="alternate" title="Bits, Bytes, and Words" type="application/atom+xml">




</head>

<body id="post" class="">

<nav class="Navigation">
  <ul class="Tags">
    
      <li class="Tag">
        
          <a href="/">Home</a>
        
      </li>
    
      <li class="Tag">
        
          <a href="/categories/">Categories</a>
        
      </li>
    
      <li class="Tag">
        
          <a href="https://jez.io">About</a>
        
      </li>
    
  </ul>
</nav>





<div class="EntryHeader">
  <h1 class="EntryHeader-title">SML Dev Setup</h1>
  <h2 class="EntryHeader-subtitle">March 9, 2016</h2>

  <ul class="Tags">
    
  </ul>
</div>



<div id="main" role="main">
  <article class="Post-content">
    <p>When it comes right down to it, SML is a pretty great language. It&rsquo;s clear that
extensive thought has gone into its design and implementation. I quite enjoy
programming in SML, due in no small part to my collection of workflow hacks that
make editing and developing with SML responsive and interactive.</p>

<!-- more -->


<p>We&rsquo;re going to be walking through a couple easy steps to make developing SML
feel more fluid. I have a slight preference for Vim (Neovim) on macOS, but many
of these steps are platform agnostic.</p>

<p><strong>Note</strong>: I updated this post to more accurately reflect my SML dev setup in
December 2019.</p>

<h2>Installing SML Locally</h2>

<p>While developing SML in a remote environment like the shared Andrew Unix
machines makes it easy to dive right in, I prefer doing development on my
laptopâ€”it doesn&rsquo;t get slow when there are many people logged in, there&rsquo;s no
nightly reboots, and it doesn&rsquo;t matter whether I have a strong WiFi connection.</p>

<p>On macOS and Ubuntu, the two most popular implementations of SML are already
packaged. Take the time to install a version of SML right now:</p>

<ul>
<li><p>At CMU we use <a href="http://smlnj.org/">SML/NJ</a>, which is convenient because it has a REPL that
for playing around with SML interactively.</p></li>
<li><p>To play around with releasing programs written in SML to other people, install
<a href="http://www.mlton.org/">MLton</a>. It has better support for compiling SML programs to standalone
executables which can be shared from one machine to another. (I have a
separate post on <a href="/sml-travis-ci/">using SML to release software publically</a>
with more details).</p></li>
</ul>


<figure class='code'><figcaption><span>Install SML from your package manager</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># macOS -- one or both of:</span>
</span><span class='line'>brew install smlnj
</span><span class='line'>brew install mlton
</span><span class='line'>
</span><span class='line'><span class="c"># Ubuntu -- one or both of:</span>
</span><span class='line'>sudo apt-get install smlnj
</span><span class='line'>sudo apt-get install mlton</span></code></pre></td></tr></table></div></figure>


<p>Feel free to install both; they&rsquo;ll play nicely with each other, and each offers
advantages over the other.</p>

<p>Note for macOS users: if you&rsquo;ve never used <a href="http://brew.sh">Homebrew</a> before, you&rsquo;ll need
to <a href="http://brew.sh">install it first</a>.</p>

<p>Note for Ubuntu users: the versions of these two that ship in the default
package distribution are frequently out of date. If that matters to you,
consider following the the <a href="http://smlnj.org/">SML/NJ</a> and <a href="http://www.mlton.org/">MLton</a> installation
instructions directly.</p>

<h2>Getting Comfortable with SML/NJ</h2>

<p>The rest of these steps should apply regardless of whether you&rsquo;re working on SML
locally or remotely.</p>

<p>One thing that I&rsquo;ve seen far too many times from course documentation is that
they tell students to run their code like this:</p>

<ol>
<li>Run <code>sml</code></li>
<li>Type <code>use "foo.sml";</code> or <code>CM.make "sources.cm";</code> at the REPL</li>
</ol>


<p>Don&rsquo;t get me wrong; this works, but there&rsquo;s a better way. Being responsible
CLI-citizens, we should always be looking for ways to tab-complete. We can
easily get tab-completion on the filename by changing our workflow:</p>

<ol>
<li>Run <code>sml foo.sml</code> or <code>sml -m sources.cm</code></li>
</ol>


<p>Look at that! We&rsquo;ve,</p>

<ul>
<li>dropped a step (having to launch the REPL first), and</li>
<li>introduced tab completion (because the shell has filename completion)</li>
</ul>


<p>It&rsquo;s the little things, but they add up.</p>

<h2>Enhancing the REPL</h2>

<p>Speaking of the little things, when using the SML REPL, you don&rsquo;t have access to
all the usual command line niceties like command history and access to arrow
keys for editing, let alone Vi-like keybindings. To get started, you&rsquo;ll have to
change how you launch the SML/NJ REPL. In particular, we&rsquo;re going to preface our
commands with <code>rlwrap</code>:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c"># instead of this...</span>
</span><span class='line'><span class="gp">$ </span>sml
</span><span class='line'>
</span><span class='line'><span class="c"># use this:</span>
</span><span class='line'><span class="gp">$ </span>rlwrap sml</span></code></pre></td></tr></table></div></figure>


<p><code>rlwrap</code> stands for &ldquo;readline wrap.&rdquo; Readline is a library that adds all the
features mentioned above to any REPL program:</p>

<ul>
<li>Command history tracking (up arrow keys)</li>
<li>Line editing with arrow keys</li>
<li>Configuration through the <code>~/.inputrc</code> file

<ul>
<li>We can use this to get fancy features like Vi keybindings</li>
</ul>
</li>
</ul>


<p>For more information, see <a href="https://github.com/jez/dotfiles/blob/ed8e531eebe43a8aef05fc4cb768157d03408cea/inputrc#L12-L14">these lines</a> of my inputrc, a small part of
my <a href="https://github.com/jez/dotfiles">dotfiles repo</a> on GitHub.</p>

<h2>Setting Up Vim</h2>

<p>Programming is so much more enjoyable when you&rsquo;re not fighting your editor. For
me, this means striving to get the most out of Vim. In this section, I&rsquo;ll
outline all the cool tips and tricks I have for developing SML in Vim.</p>

<p>But first, if you&rsquo;ve never taken a look into how to configure Vim, I suggest you
start out by walking through this quick workshop called <a href="https://github.com/jez/vim-as-an-ide">Vim as an
IDE</a>. It&rsquo;ll teach you where to start when configuring Vim and get
you set up with a bunch of standard plugins that improve on the standard Vim
experience tenfold.</p>

<p>No actually, take a second and <a href="https://github.com/jez/vim-as-an-ide">walk through it</a>. We&rsquo;ll still be
here when you&rsquo;re done, and you&rsquo;ll appreciate Vim more when you&rsquo;re done.</p>

<h3>ALE</h3>

<p><a href="https://github.com/dense-analysis/ale">ALE</a> is a Vim plugin that provides what it calls &ldquo;asynchronous linting.&rdquo;
That&rsquo;s a fancy way of saying that it can show little red x&rsquo;s on all the lines
that have errors. It works for many languages out of the box, including Standard
ML.</p>

<p>It&rsquo;s super simple to set up. The <a href="https://github.com/dense-analysis/ale">ALE homepage</a> should have all the
instructions.</p>

<p>With ALE set up, try writing this into a file called <code>test.sml</code>:</p>

<figure class='code'><figcaption><span>test.sml</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='sml'><span class='line'><span class="kr">val</span> <span class="nv">foo</span> <span class="p">:</span> <span class="n">string</span> <span class="p">=</span> <span class="mi">42</span></span></code></pre></td></tr></table></div></figure>


<p>While typing, any errors should appear as markers to the left of the line
numbers. Super handy!</p>

<p>If nothing shows up, check <code>:ALEInfo</code> which dumps a bunch of information
about whether ALE was set up correctly. In particular, SML support requires
having <a href="http://smlnj.org/">SML/NJ</a> installed (i.e., installing it on your laptop or working
on a server where it&rsquo;s already installed).</p>

<h3>Extra ALE Setup</h3>

<p>While the default settings for ALE work well enough, there&rsquo;s plenty of reasons
to tweak them. For example, here are <a href="https://github.com/jez/dotfiles/blob/b942b6336ee968c9d94a9ea363c1cbcdb44b9846/vim/plug-settings.vim#L227-L239">all my ALE settings</a>.</p>

<p>The key changes I make:</p>

<ul>
<li>I ask ALE to show a list of all errors if there were any.</li>
<li>I ask ALE to only run when the file was saved (not when it was opened or
edited).</li>
</ul>


<p>(You&rsquo;ll also see a bunch of settings for other languages, but you won&rsquo;t find any
SML-specific config&hellip; it&rsquo;s not needed!)</p>

<p>Also, a tip for those who&rsquo;ve never used Vim&rsquo;s location list: you can close the
list of errors with <code>:lclose</code>.</p>

<h3>Using ALE with CM files</h3>

<p>Sometimes a single SML file is self-contained enough to type check on it&rsquo;s own.
But most of the time, we&rsquo;re working with multi-file SML projects. With SML/NJ,
multi-file SML projects are managed using CM files (<code>*.cm</code> files) which declare
groups of SML files that must be compiled together to make sense.</p>

<p>ALE&rsquo;s support for SML handles both of these scenarios. When opening an SML file,
ALE will search up the folder hierarchy for any <code>*.cm</code> file, stopping when it
finds the first one. When there are multiple in a single folder, it takes the
alphabetically first option.</p>

<p>Usually this works fine but sometimes ALE picks the wrong one. There are
instructions for how to manually fix this by setting some variables in the ALE
help:</p>

<figure class='code'><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class=''><span class='line'>:help ale-sml-options</span></code></pre></td></tr></table></div></figure>


<h3><code>vim-better-sml</code></h3>

<p>After all that, I still wasn&rsquo;t satisfied with developing SML in Vim, so I wrote
a plugin to make it even better: <a href="https://github.com/jez/vim-better-sml">vim-better-sml</a>. Here&rsquo;s a
quick rundown of its features:</p>

<ul>
<li>It supports for embedding a REPL directly inside Vim.</li>
<li>It supports asking for the type of a variable under the cursor.</li>
<li>It supports jump to definition, even into the Standard Basis Library.</li>
<li><code>*.sig</code> files are properly detected as SML signature files.</li>
<li>Many small annoyances with syntax highlighting and indentation are fixed.</li>
</ul>


<p>For more information, including how to install it, check out the homepage:
<a href="https://github.com/jez/vim-better-sml">vim-better-sml</a>. For the most part, the plugin itself will
guide you through the installation, declaring any dependencies that might be
missing.</p>

<p>I recorded a screencast of all those features above in action, which you might
want to check out:</p>

<p><a href="https://youtu.be/Z5FsPZ5cm8Y"><img src="/images/vim-better-sml-demo-thumbnail.png" alt="thumbnail" /></a></p>

<h2>General Vim Settings</h2>

<p>As a quick addendum, one common complaint people have when editing SML is that
it forces the line to wrap if it extends past 80 characters. Some people don&rsquo;t
like that, and others don&rsquo;t like that it doesn&rsquo;t do it frequently enough
(namely, it only wraps the line if your <strong>cursor</strong> extends past 80 characters,
not the end of the line).</p>

<p>If you don&rsquo;t want Vim to do any of this wrapping, run this:</p>

<figure class='code'><figcaption><span>Disable hard line wrapping</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="k">setlocal</span> textwidth<span class="p">=</span><span class="m">0</span></span></code></pre></td></tr></table></div></figure>


<p>If you&rsquo;d like this change to persist between Vim sessions, add it to
<code>~/.vim/after/ftplugin/sml.vim</code>. These folders and file likely don&rsquo;t exist
yet; you&rsquo;ll have to create them. The <code>after</code> folder in Vim is used to override
settings loaded from plugins.</p>

<p>Alternatively, if you&rsquo;d like a little better idea when Vim&rsquo;s going to hard wrap
your line, you can add one of these lines to your vimrc:</p>

<figure class='code'><figcaption><span>Show a color column</span></figcaption><div class="highlight"><table><tr></pre></td><td class='code'><pre><code class='vim'><span class='line'><span class="c">" Always draw the line at 80 characters</span>
</span><span class='line'><span class="k">set</span> colorcolumn<span class="p">=</span><span class="m">80</span>
</span><span class='line'>
</span><span class='line'><span class="c">" Draw the line at whatever the current value of textwidth is</span>
</span><span class='line'><span class="k">set</span> colorcolumn<span class="p">+=</span><span class="m">0</span></span></code></pre></td></tr></table></div></figure>


<p>That way, it&rsquo;s easier to see when a line is getting long.</p>

<h2>TL;DR</h2>

<p>We covered a lot, so here&rsquo;s a quick recap:</p>

<ul>
<li>Install SML locally. It&rsquo;s super easy to do on macOS and Linux (use your
package manager), and means you don&rsquo;t have to have a Wi-Fi connection to
develop SML.</li>
<li>Invest time into learning Vim. Here&rsquo;s a reference: <a href="https://github.com/jez/vim-as-an-ide">Vim as an
IDE</a>.</li>
<li>Install <a href="https://github.com/dense-analysis/ale">ALE</a>. It tells you what lines your errors are on.</li>
<li>Install <a href="https://github.com/jez/vim-better-sml">vim-better-sml</a>. It includes a whole host of added
power features.</li>
</ul>


<p>And as always, you can see even more Vim settings in my <a href="https://github.com/jez/dotfiles">dotfiles
repo</a> on GitHub.</p>

    <footer class="entry-meta">
      <span class="entry-tags">
        <ul class="Tags">
          
            <li class="Tag">
              <a href="/categories/#vim" title="Pages tagged vim">vim</a>
            </li>
          
            <li class="Tag">
              <a href="/categories/#osx" title="Pages tagged osx">osx</a>
            </li>
          
            <li class="Tag">
              <a href="/categories/#sml" title="Pages tagged sml">sml</a>
            </li>
          
        </ul>
      </span>
      <span class="entry-date date published updated"><time datetime="2016-03-09T20:06:15-06:00">March 9, 2016</time></span>
      
    </footer>
  </div>
  
  <div class="read-more">
    
      <div class="read-more-header">
        <a href="/sorbet-pipeline-overview/" class="Button">Read More</a>
      </div><!-- /.read-more-header -->
      <div class="read-more-content">
        <h3><a href="/sorbet-pipeline-overview/" title="How Sorbet Works: An Overview">How Sorbet Works: An Overview</a></h3>
      <p>TODO <a href="/sorbet-pipeline-overview/"> Continue reading</a></p>
        </div><!-- /.read-more-content -->
      
      <div class="read-more-list">
        
          <div class="list-item">
            <h4><a href="/ruby-mutation/" title="What makes type checking Ruby hard?">What makes type checking Ruby hard?</a></h4>
            <span>Published on December 29, 2019</span>
          </div><!-- /.list-item -->
        
          <div class="list-item">
            <h4><a href="/surgery-on-code/" title="Surgery on Code from the Command Line">Surgery on Code from the Command Line</a></h4>
            <span>Published on July 30, 2019</span>
          </div><!-- /.list-item -->
        
      </div><!-- /.read-more-list -->
  </div><!-- /.read-more -->


</div>

<div class="footer-wrapper">
  Blog source on <a href="https://github.com/jez/blog">GitHub</a>.

</div>

</body>
</html>
